id: k-2026-0216-024
title: ZEPHYR_EXTRA_MODULES causes double-registration with workspace module.yml
body: |-
  If a library's test CMakeLists.txt adds itself via `ZEPHYR_EXTRA_MODULES` AND the workspace-level `zephyr/module.yml` already auto-discovers it (via `build: cmake: lib`), CMake fails with a binary directory collision error:

  ```
  CMake Error at zephyr/CMakeLists.txt:776 (add_subdirectory): The binary directory
  ```

  The module gets added twice â€” once via ZEPHYR_EXTRA_MODULES, once via add_subdirectory from lib/CMakeLists.txt.

  Fix: Remove `ZEPHYR_EXTRA_MODULES` from test CMakeLists.txt. Rely on auto-discovery:
  ```cmake
  # Library is auto-discovered via the workspace-level zephyr/module.yml
  # No ZEPHYR_EXTRA_MODULES needed.
  find_package(Zephyr REQUIRED HINTS $ENV{ZEPHYR_BASE})
  ```

  This only happens in workspaces with module.yml-based auto-discovery. Standalone module tests still need ZEPHYR_EXTRA_MODULES.
category: toolchain
severity: important
applies_to:
  boards: []
  chips: []
  tools:
  - twister
  - west
  subsystems:
  - cmake
  - ci
file_patterns:
- '**/tests/CMakeLists.txt'
- '**/module.yml'
status: unvalidated
validated_by: []
deprecated: false
superseded_by: null
created: 2026-02-16
updated: 2026-02-16
author: danahern
source_session: null
tags:
- zephyr
- cmake
- modules
- twister
- ci
