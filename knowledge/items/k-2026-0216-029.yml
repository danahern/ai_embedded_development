id: k-2026-0216-029
title: ESP-IDF credential API must return proper errno values for cross-platform compatibility
body: |-
  When implementing platform-specific backends for shared library APIs, use proper POSIX errno values (not generic `-1`). The ESP-IDF credential implementation (`wifi_prov_cred_esp.c`) initially returned `-1` for all errors, but the Zephyr version and unit tests expect:

  - `-EINVAL` for invalid parameters (null pointer, zero-length SSID, oversized SSID)
  - `-ENOENT` for "no credentials stored" on load

  This matters because shared unit tests verify the API contract, and generic `-1` breaks assertions like `TEST_ASSERT_EQUAL(-ENOENT, ret)`.

  Fix: `#include <errno.h>` and use `-EINVAL`/`-ENOENT` in return statements. The errno constants are available on both Zephyr (via POSIX) and ESP-IDF (via newlib).
category: pattern
severity: important
applies_to:
  boards: []
  chips: []
  tools: []
  subsystems:
  - wifi_prov
  - credentials
file_patterns:
- '**/*cred*.c'
- '**/*_cred*.c'
status: unvalidated
validated_by: []
deprecated: false
superseded_by: null
created: 2026-02-16
updated: 2026-02-16
author: claude
source_session: null
tags:
- errno
- api-contract
- cross-platform
- esp-idf
- credentials
