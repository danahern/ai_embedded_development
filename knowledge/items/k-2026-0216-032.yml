id: k-2026-0216-032
title: 'macOS POSIX gaps: 3 missing APIs require workarounds'
body: |-
  macOS is POSIX-compliant but lacks three commonly-assumed APIs:

  1. **`pthread_mutex_timedlock`** — not in macOS SDK at all. Workaround: `pthread_mutex_trylock` in a 1ms sleep loop. Acceptable for test timeouts (50-200ms) but not for high-frequency production use.

  2. **`sem_init` / `sem_t` unnamed semaphores** — deprecated on macOS. Workaround: implement counting semaphore with `pthread_mutex_t` + `pthread_cond_t` + counter. Works identically, no platform-specific code needed.

  3. **`timer_create` / `timer_settime`** — POSIX per-process timers don't exist on macOS. Workaround: dedicated `pthread` per timer that blocks on `pthread_cond_timedwait`. Simple, works on both platforms.

  Also: `pthread_condattr_setclock(CLOCK_MONOTONIC)` is not supported on macOS. Use `CLOCK_REALTIME` for condvar timeouts (acceptable for short durations in tests).
category: toolchain
severity: important
applies_to:
  boards: []
  chips: []
  tools:
  - pthread
  subsystems:
  - osal
file_patterns:
- '**/posix/*.c'
- '**/posix/*.h'
status: unvalidated
validated_by: []
deprecated: false
superseded_by: null
created: 2026-02-16
updated: 2026-02-16
author: claude
source_session: null
tags:
- macOS
- POSIX
- pthreads
- portability
